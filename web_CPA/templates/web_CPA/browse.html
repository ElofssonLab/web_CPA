{% extends "web_CPA/base_layout.html" %}
{% load static %}

{%block content_main %}
<script src="{% static "js/modernizr-2.8.3.min.js" %}"></script>
<link rel="stylesheet" href="{% static "css/style.css" %}">
<div class="container" id="general_container" style="padding-top: 25px">
	<ul class="nav nav-tabs">
	  <li class="nav-item">
		<a class="nav-link active" data-toggle="tab" href="#btable">Table</a>
	  <li class="nav-item">
		<a class="nav-link" data-toggle="tab" href="#overview">Overview</a>
	  </li>
	</ul>

	<div class="tab-content">
		  <!--
		<img class="img-responsive" style="max-width:100%" src="{% static "data/CPA/Heirarchy_figure.svg" %}" alt="CPAfold" usemap="#image-map">
		  -->
		<!-- Image Map Generated by http://www.image-map.net/ -->
		<!-- <img src="Heirarchy_figure.png" usemap="#image-map"> -->

		<div class="container tab-pane active" id="btable" style="padding-top: 25px; padding-bottom: 150px">
		  <!--
		<map name="image-map">
			<area target="" alt="AbrB" title="AbrB" href="/details/AbrB" coords="56,420,94,436" shape="rect">
			<area target="" alt="DUF819" title="DUF819" href="/details/DUF819" coords="210,391,264,410" shape="rect">
			<area target="" alt="Glt_symporter" title="Glt_symporter" href="/details/Glt_symporter" coords="214,416,296,432" shape="rect">
			<area target="" alt="Asp-Al_Ex" title="Asp-Al_Ex" href="/details/Asp-Al_Ex" coords="215,435,324,447" shape="rect">
			<area target="" alt="2HCT" title="2HCT" href="/details/2HCT" coords="393,394,433,407" shape="rect">
			<area target="" alt="Na_H_antiport_1" title="Na_H_antiport_1" href="/details/Na_H_antiport_1" coords="552,415,660,427" shape="rect">
			<area target="" alt="SBF_like" title="SBF_like" href="/details/SBF_like" coords="769,380,827,396" shape="rect">
			<area target="" alt="KdgT" title="KdgT" href="/details/KdgT" coords="767,401,808,418" shape="rect">
			<area target="" alt="Mem_trans" title="Mem_trans" href="/details/Mem_trans" coords="924,401,995,418" shape="rect">
			<area target="" alt="Cons_hypoth698_1" title="Cons_hypoth698_1" href="/details/Cons_hypoth698_1" coords="57,590,174,610" shape="rect">
			<area target="" alt="Cons_hypoth698_2" title="Cons_hypoth698_2" href="/details/Cons_hypoth698_2" coords="254,580,376,600" shape="rect">
			<area target="" alt="Na_H_Exchanger_1" title="Na_H_Exchanger_1" href="/details/Na_H_Exchanger_1" coords="420,590,560,610" shape="rect">
			<area target="" alt="Na_H_Exchanger_2" title="Na_H_Exchanger_2" href="/details/Na_H_Exchanger_2" coords="600,590,730,610" shape="rect">
			<area target="" alt="SBF_1" title="SBF_1" href="/details/SBF_1" coords="830,600,880,620" shape="rect">
			<area target="" alt="SBF_2" title="SBF_2" href="/details/SBF_2" coords="1025,600,1075,620" shape="rect">
		</map>
		  -->
			<div class="row">
			 <table id="browse_table" class="table table-striped table-bordered"
				 style="width:100%;padding:.25em">
				 <!-- Family, Topology,Fold-type, Pfam family, Pfam clan, TCDB family, TCDB superfamily -->	
			   <tfoot>
				 <tr>
				   <th>Family</th>
				   <th>Topology</th>
				   <th>Fold-type</th>
				   <th>Pfam-Family</th>
				   <th>Pfam-Clan</th>
				   <th>TCDB-Family</th>
				   <th>TCDB-Superfamily</th>
				   <!-- <th>TCDB</th>
				   <th>OPM</th>
				   <th>CATH</th> -->

				   <!--               <th>model</th> -->
				 </tr>
				 </tfoot>
			 </table>
			</div>
	    </div> <!-- /container -->

		<div class="container tab-pane fade" id="overview" style="padding-top: 25px; padding-bottom: 150px">
			<div class="row">
				<p>
				Availability of experimentally solved structures of transmembrane transporters are sparse. We expand the structural knowledge of the CPA_AT clan by using integrated topology annotation and protein modelling approaches. It combines transmembrane topology prediction, homology/ab initio protein modelling, and the difference in positively charged residues present in inside and outside loops in alternative topological models. CPA_AT clan includes very challenging cases with non-canonical broken or reentrant helices. There are 4 folds in this clan. They are the (1) CPA-Broken-fold (2) CPA-Reentrant-fold (3)BART-fold (4) Reentrant-helix-reentrant fold.
				<br><br>
	The database presents new topologies, 3D structure models and their folds for all the families in this clan. The Reentrant-helix-reentrant fold is a novel fold that has been identified in this work and was not known previously.Novel reentrant motifs for the reentrant type transporters have been identified. Full length and repeat level topology and sequence alignments of a particular protein family with all the other families in the superfamily are provided. This becomes helpful for comparison of structure and function of related families of interest. The alignments are very easy to follow with topology being mapped on to the sequence alignment.User can check which family his/her protein of interest belongs to.The protein of interest can be aligned with the family MSA belonging to all the families using HHalign program. The protein can be assigned to that particular family that shows the lowest evalue with protein of interest.Topology seed MSA can be used to  extrapolate the topology, repeat regions, core and scaffold regions. This can be carried out by aligning the protein of interest and topology seed MSA by HHalign program. Once family has been assigned to the protein of interest, fold-type, broken/reeentrant type can 

				</p>
			</div> <!-- /row -->
	    </div> <!-- /container -->
      </div> <!-- /tab-content -->
<style>

tfoot {
        display: table-header-group;
            }
table.dataTable td, table.dataTable th {
  padding: .25em;
}
    /*headers = ["Superfamily", "Fold-type","Family","Subfamily","Topology", "Pfam-Clan", "Pfam"]*/
</style>
<script type="text/javascript">
	var dataset = {{ tableData|safe }};
  var inital_search = "";
$.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        /* var lmin = parseInt( $('#LengthMin').val(), 10 );
        var lmax = parseInt( $('#LengthMax').val(), 10 );
        var length = parseFloat( data[2] ) || 0; // use data for the age column
        var meffmin = parseInt( $('#MeffMin').val(), 10 );
        var meffmax = parseInt( $('#MeffMax').val(), 10 );
        var meff = parseFloat( data[3] ) || 0; // use data for the age column
        var fdrmin = parseFloat( $('#FDRMin').val(), 10 );
        var fdrmax = parseFloat( $('#FDRMax').val(), 10 );
        var fdr = parseFloat( data[4] ) || 0; // use data for the age column
        var pconsmin = parseFloat( $('#PconsMin').val(), 10 );
        var pconsmax = parseFloat( $('#PconsMax').val(), 10 );
        var pcons = parseFloat( data[5] ) || 0; // use data for the age column
        var proq3min = parseFloat( $('#ProQ3Min').val(), 10 );
        var proq3max = parseFloat( $('#ProQ3Max').val(), 10 );
        var proq3 = parseFloat( data[6] ) || 0; // use data for the age column
        var tmmin = parseFloat( $('#TMMin').val(), 10 );
        var tmmax = parseFloat( $('#TMMax').val(), 10 );
        var tm = parseFloat( data[7] ) || 0; // use data for the age column
 
        if ( (( isNaN( lmin ) && isNaN( lmax ) ) ||
             ( isNaN( lmin ) && length <= lmax ) ||
             ( lmin <= length   && isNaN( lmax ) ) ||
             ( lmin <= length   && length <= lmax )) &&
             
             (( isNaN( meffmin ) && isNaN( meffmax ) ) ||
             ( isNaN( meffmin ) && meff <= meffmax ) ||
             ( meffmin <= meff   && isNaN( meffmax ) ) ||
             ( meffmin <= meff   && meff <= meffmax )) &&

             (( isNaN( fdrmin ) && isNaN( fdrmax ) ) ||
             ( isNaN( fdrmin ) && fdr <= fdrmax ) ||
             ( fdrmin <= fdr   && isNaN( fdrmax ) ) ||
             ( fdrmin <= fdr   && fdr <= fdrmax )) &&
        
             (( isNaN( pconsmin ) && isNaN( pconsmax ) ) ||
             ( isNaN( pconsmin ) && pcons <= pconsmax ) ||
             ( pconsmin <= pcons   && isNaN( pconsmax ) ) ||
             ( pconsmin <= pcons   && pcons <= pconsmax )) &&

             (( isNaN( proq3min ) && isNaN( proq3max ) ) ||
             ( isNaN( proq3min ) && proq3 <= proq3max ) ||
             ( proq3min <= proq3   && isNaN( proq3max ) ) ||
             ( proq3min <= proq3   && proq3 <= proq3max )) &&

             (( isNaN( tmmin ) && isNaN( tmmax ) ) ||
             ( isNaN( tmmin ) && tm <= tmmax ) ||
             ( tmmin <= tm   && isNaN( tmmax ) ) ||
             ( tmmin <= tm   && tm <= tmmax ))
        )
        {
            return true;
        }
        return false; */
		return true;
    }
);
$(document).ready(function() {
    $('#browse_table tfoot th').each( function () {
            var title = $(this).text();
      /*if ((title == 'Length') || (title == 'Meff') || (title == 'FDR') || (title == 'Pcons') || (title == 'ProQ3') || (title == 'TM')) {
            $(this).html( '<input type="text" id="' + title + 'Min" placeholder="Min" style="width:45%;margin-right:8%"/>' + 
                          '<input type="text" id="' + title + 'Max" placeholder="Max" style="width:45%;"/>'  );
      }
      else { */
            $(this).html( '<input type="text" id="' + title + '" placeholder="Search '+title+'" style="width: 100%" />' );
      /*} */} );
    var table = $('#browse_table').DataTable( {
        data: dataset,
				 <!-- Family, Topology,Fold-type, Pfam family, Pfam clan, TCDB family, TCDB superfamily -->	
        columns: [
            { title: "Family"}, /*, className: "text-right"*/
            { title: "Topology"},
            { title: "Fold-type"},
			{ title: "Pfam-Family"},
			{ title: "Pfam-Clan"},
			{ title: "TCDB-Family"},
			{ title: "TCDB-Superfamily"}
			// { title: "TCDB"},
			// { title: "OPM"},
			// { title: "CATH"},
            // { title: "Has model"}
        ],
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "iDisplayLength": 25,
      "paging": true,
      "oSearch": {"sSearch": "{{ initial_search }}"}
    } );
    /*$('#LengthMin, #LengthMax, #MeffMin, #MeffMax, #FDRMin, #FDRMax, #PconsMin, #PconsMax, #ProQ3Min, #ProQ3Max, #TMMin, #TMMax').keyup( function() {
        table.draw();
    } );*/
    table.columns().every( function () {
            var that = this;
     
				 <!-- Family, Topology,Fold-type, Pfam family, Pfam clan, TCDB family, TCDB superfamily -->	
            $( '#Family, #Topology, #Fold-type, #Pfam-Family, #Pfam-Clan, #TCDB-Family, #TCDB-Superfamily', this.footer() ).on( 'keyup change', function () {
            // $( '#Superfamily, #Fold-type, #Family, #Subfamily, #Topology, #Pfam-Clan, #Pfam, #TCDB #OPM #CATH', this.footer() ).on( 'keyup change', function () {
                if ( that.search() !== this.value ) {
                    that
                        .search( this.value )
                        .draw();
                }
            } );
        } );
} );
</script>

{% endblock %}
