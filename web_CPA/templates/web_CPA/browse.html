{% extends "web_CPA/base_layout.html" %}
{% load static %}

{%block content_main %}
      <div class="container" style="padding-top: 25px">
		<img class="img-responsive" style="max-width:100%" src="{% static "data/CPA/Heirarchy_figure.svg" %}" alt="CPAfold">
        <div class="row">
         <table id="browse_table" class="table table-striped table-bordered"
             style="width:100%;padding:.25em">
           <tfoot>
             <tr>
               <th>Subfamily</th>
               <th>Family</th>
               <th>Superfamily</th>
               <th>Fold-type</th>
               <th>Topology</th>
               <th>Pfam</th>
               <!--               <th>model</th> -->
             </tr>
             </tfoot>
         </table>
        </div>
      </div> <!-- /container -->
<style>
tfoot {
        display: table-header-group;
            }
table.dataTable td, table.dataTable th {
  padding: .25em;
}
    /*headers = ["Superfamily", "Fold-type","Family","Subfamily","Topology", "Pfam"]*/
</style>
<script type="text/javascript">
	var dataset = {{ tableData|safe }};
  var inital_search = "";
$.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        /* var lmin = parseInt( $('#LengthMin').val(), 10 );
        var lmax = parseInt( $('#LengthMax').val(), 10 );
        var length = parseFloat( data[2] ) || 0; // use data for the age column
        var meffmin = parseInt( $('#MeffMin').val(), 10 );
        var meffmax = parseInt( $('#MeffMax').val(), 10 );
        var meff = parseFloat( data[3] ) || 0; // use data for the age column
        var fdrmin = parseFloat( $('#FDRMin').val(), 10 );
        var fdrmax = parseFloat( $('#FDRMax').val(), 10 );
        var fdr = parseFloat( data[4] ) || 0; // use data for the age column
        var pconsmin = parseFloat( $('#PconsMin').val(), 10 );
        var pconsmax = parseFloat( $('#PconsMax').val(), 10 );
        var pcons = parseFloat( data[5] ) || 0; // use data for the age column
        var proq3min = parseFloat( $('#ProQ3Min').val(), 10 );
        var proq3max = parseFloat( $('#ProQ3Max').val(), 10 );
        var proq3 = parseFloat( data[6] ) || 0; // use data for the age column
        var tmmin = parseFloat( $('#TMMin').val(), 10 );
        var tmmax = parseFloat( $('#TMMax').val(), 10 );
        var tm = parseFloat( data[7] ) || 0; // use data for the age column
 
        if ( (( isNaN( lmin ) && isNaN( lmax ) ) ||
             ( isNaN( lmin ) && length <= lmax ) ||
             ( lmin <= length   && isNaN( lmax ) ) ||
             ( lmin <= length   && length <= lmax )) &&
             
             (( isNaN( meffmin ) && isNaN( meffmax ) ) ||
             ( isNaN( meffmin ) && meff <= meffmax ) ||
             ( meffmin <= meff   && isNaN( meffmax ) ) ||
             ( meffmin <= meff   && meff <= meffmax )) &&

             (( isNaN( fdrmin ) && isNaN( fdrmax ) ) ||
             ( isNaN( fdrmin ) && fdr <= fdrmax ) ||
             ( fdrmin <= fdr   && isNaN( fdrmax ) ) ||
             ( fdrmin <= fdr   && fdr <= fdrmax )) &&
        
             (( isNaN( pconsmin ) && isNaN( pconsmax ) ) ||
             ( isNaN( pconsmin ) && pcons <= pconsmax ) ||
             ( pconsmin <= pcons   && isNaN( pconsmax ) ) ||
             ( pconsmin <= pcons   && pcons <= pconsmax )) &&

             (( isNaN( proq3min ) && isNaN( proq3max ) ) ||
             ( isNaN( proq3min ) && proq3 <= proq3max ) ||
             ( proq3min <= proq3   && isNaN( proq3max ) ) ||
             ( proq3min <= proq3   && proq3 <= proq3max )) &&

             (( isNaN( tmmin ) && isNaN( tmmax ) ) ||
             ( isNaN( tmmin ) && tm <= tmmax ) ||
             ( tmmin <= tm   && isNaN( tmmax ) ) ||
             ( tmmin <= tm   && tm <= tmmax ))
        )
        {
            return true;
        }
        return false; */
		return true;
    }
);
$(document).ready(function() {
    $('#browse_table tfoot th').each( function () {
            var title = $(this).text();
      /*if ((title == 'Length') || (title == 'Meff') || (title == 'FDR') || (title == 'Pcons') || (title == 'ProQ3') || (title == 'TM')) {
            $(this).html( '<input type="text" id="' + title + 'Min" placeholder="Min" style="width:45%;margin-right:8%"/>' + 
                          '<input type="text" id="' + title + 'Max" placeholder="Max" style="width:45%;"/>'  );
      }
      else { */
            $(this).html( '<input type="text" id="' + title + '" placeholder="Search '+title+'" style="width: 100%" />' );
      /*} */} );
    var table = $('#browse_table').DataTable( {
        data: dataset,
        columns: [
            { title: "Subfamily"},
            { title: "Family"}, /*, className: "text-right"*/
            { title: "Superfamily"},
            { title: "Fold-type"},
            { title: "Topology"},
			{ title: "Pfam"},
            // { title: "Has model"}
        ],
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "iDisplayLength": 25,
      "paging": true,
      "oSearch": {"sSearch": "{{ initial_search }}"}
    } );
    /*$('#LengthMin, #LengthMax, #MeffMin, #MeffMax, #FDRMin, #FDRMax, #PconsMin, #PconsMax, #ProQ3Min, #ProQ3Max, #TMMin, #TMMax').keyup( function() {
        table.draw();
    } );*/
    table.columns().every( function () {
            var that = this;
     
            $( '#Superfamily, #Fold-type, #Family, #Subfamily, #Topology, #Pfam', this.footer() ).on( 'keyup change', function () {
                if ( that.search() !== this.value ) {
                    that
                        .search( this.value )
                        .draw();
                }
            } );
        } );
} );
</script>

{% endblock %}
