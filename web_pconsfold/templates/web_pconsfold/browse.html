{% extends "web_pconsfold/base_layout.html" %}

{%block content_main %}
      <div class="container" style="padding-top: 25px">
        <div class="row">
         <table id="browse_table" class="table table-striped table-bordered"
             style="width:100%;padding:.25em">
           <tfoot>
             <tr>
               <th>Acc</th>
               <th>Clan</th>
               <th>Length</th>
               <th>Meff</th>
               <th>FDR</th>
               <th>structure</th>
               <th>model</th>
             </tr>
             </tfoot>
         </table>
        </div>
      </div> <!-- /container -->
<style>
tfoot {
        display: table-header-group;
            }
table.dataTable td, table.dataTable th {
  padding: .25em;
}
</style>
<script type="text/javascript">
	var dataset = {{ tableData|safe }};
  var inital_search = "";
$.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        var lmin = parseInt( $('#LengthMin').val(), 10 );
        var lmax = parseInt( $('#LengthMax').val(), 10 );
        var length = parseFloat( data[2] ) || 0; // use data for the age column
        var meffmin = parseInt( $('#MeffMin').val(), 10 );
        var meffmax = parseInt( $('#MeffMax').val(), 10 );
        var meff = parseFloat( data[3] ) || 0; // use data for the age column
        var fdrmin = parseFloat( $('#FDRMin').val(), 10 );
        var fdrmax = parseFloat( $('#FDRMax').val(), 10 );
        var fdr = parseFloat( data[4] ) || 0; // use data for the age column
 
        if ( (( isNaN( lmin ) && isNaN( lmax ) ) ||
             ( isNaN( lmin ) && length <= lmax ) ||
             ( lmin <= length   && isNaN( lmax ) ) ||
             ( lmin <= length   && length <= lmax )) &&
             
             (( isNaN( meffmin ) && isNaN( meffmax ) ) ||
             ( isNaN( meffmin ) && meff <= meffmax ) ||
             ( meffmin <= meff   && isNaN( meffmax ) ) ||
             ( meffmin <= meff   && meff <= meffmax )) &&

             (( isNaN( fdrmin ) && isNaN( fdrmax ) ) ||
             ( isNaN( fdrmin ) && fdr <= fdrmax ) ||
             ( fdrmin <= fdr   && isNaN( fdrmax ) ) ||
             ( fdrmin <= fdr   && fdr <= fdrmax ))
        
        )
        {
            return true;
        }
        return false;
    }
);
$(document).ready(function() {
    $('#browse_table tfoot th').each( function () {
            var title = $(this).text();
      if ((title == 'Length') || (title == 'Meff') || (title == 'FDR')) {
            $(this).html( '<input type="text" id="' + title + 'Min" placeholder="Min" style="width:45%;margin-right:8%"/>' + 
                          '<input type="text" id="' + title + 'Max" placeholder="Max" style="width:45%;"/>'  );
      }
      else {
            $(this).html( '<input type="text" id="' + title + '" placeholder="Search '+title+'" style="width: 100%" />' );
      }} );
    var table = $('#browse_table').DataTable( {
        data: dataset,
        columns: [
            { title: "PFAM-A acc"},
            { title: "Clan"},
            { title: "Length", className: "text-right"},
            { title: "Meff", className: "text-right"},
            { title: "FDR", className: "text-right" },
            { title: "Has structure"},
            { title: "Has model"}
        ],
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      "iDisplayLength": 25,
      "paging": true,
      "oSearch": {"sSearch": "{{ initial_search }}"}
    } );
    $('#LengthMin, #LengthMax, #MeffMin, #MeffMax, #FDRMin, #FDRMax').keyup( function() {
        table.draw();
    } );
    table.columns().every( function () {
            var that = this;
     
            $( '#Acc, #Clan, #structure, #model', this.footer() ).on( 'keyup change', function () {
                if ( that.search() !== this.value ) {
                    that
                        .search( this.value )
                        .draw();
                }
            } );
        } );
} );
</script>

{% endblock %}
